# Индивидуальное домашнее задание №2

## Выполнил: Натро Давид, БПИ216 (ФКН, ПИ, 2 курс)

### ~~Контакты~~

## Задача
Разработать программу, которая вычисляет количество цифр и букв в заданной ASCII-строке.
> 16 вариант

# Инструкция к применению
## Запуск
Программа работает в 2х вариантах обработки данных:<br>

1) Файловый ввод/вывод.<br>
Для запуска пропишите команду:<br> ```./main.exe <input file> <output file>```,<br>где первым подаётся входной файл, а вторым выходной.<br>
2) Рандомный ввод и файловый вывод:<br>
Для запуска пропишите команду:<br>
```./main.exe -random <output file>```,<br>где output file - файл в который будет записан результат.

* В случае возникновения ошибки - будет выведено сообщение в консоль.
* По окончанию любого из вариантов работы программы замеры по времени будут выведены в консоль.
## Тестирование
Перейдите в папку ```tests``` и запустите скрипт ```script.py```, написанный на питоне, результаты тестов будут выведены в консоль. Более подробно с тестированием Вы можете ознакомиться, прочитав файл README.md, который находится в той же папке.
# <br> Отчет
### Задание выполнено на 9 балов.<br>
Далее будет указан каждый выполнений пункт. Более подробные комментарии, где это требуется, можно будет увидеть, как в примере ниже, под соответствующим критерием.
* Некоторый критерий
    > более подробное описание.

#

### 4 бала
* Приведено решение задачи на C :white_check_mark:
  > Файлы: main.c, read.c, print.c
* В полученную ассемблерную программу, откомпилированную без оптимизирующих и отладочных опций, добавлены комментарии, поясняющие эквивалентное представление переменных в программе на C. :white_check_mark:
  > К каждой переменной добавлен комментарий.
* Из ассемблерной программы убраны лишние макросы за счет использования соответствующих аргументов командной строки и/или за счет ручного редактирования исходного текста ассемблерной программы. :white_check_mark:
  > Комментарии в последнем критерии на 4 бала
* Модифицированная ассемблерная программа отдельно откомпилирована и скомпонована без использования опций отладки. :white_check_mark:
  > Комментарии в последнем критерии на 4 бала
* Представлено полное тестовое покрытие, дающее одинаковый результат на обоих программах. Приведены результаты тестовых прогонов для обоих программ, демонстрирующие эквивалентность функционирования. :white_check_mark:
  > В папке tests предоставлен скрипт script.py, который запускает тестирование и выводит его результат. Более подробно со скриптом можно ознакомиться прочитав файл README.md, который находится в той же папке tests. В той же папке имеется файл report.txt, прочитав его, Вы можете ознакомиться с результатами тестовых прогонов. 
* Сформировать отчет, описывающий результаты тестовых прогонов и используемых опций компиляции и/или описания проведенных модификаций. :white_check_mark:
    > Обе программы проходят тестовое покрытие (отчет можно найти в папке tests или же убедиться лично, запустив скрипт script.py). <br><br>
    Было оптимизировано большое количество кода
    заменой строчек вида:<br>
    lea reg1, reg2<br>
    mov reg3, reg1<br>
    на строчки вида:<br>
    lea reg3, reg2<br>
    Сравнения теперь происходят напрямую, без использования
    "вспомогательных" регистров. <br>
    Удалено большое количество nop. <br><br>
    Опции компиляции: Вы можете ознакомиться с командами, применяющимися для компиляции проекта в файле build.py.
    Мной был написан скрипт на питоне, который позволил сэкономить много времени, благодаря автоматизации процесса компиляции. В данном скрипте вы увидите первые 3 команды, которые позволяли переводить C код в компактный ассемблер. После написаны 3 команды, которые переводили ассемблерные файлы в объектные. Последняя команда выполняла линковку, после чего удалялись все объектные файлы, происходил запуск программы и в консоль выводился результат её работы.


### 5 балов
* В реализованной программе необходимо использовать функции с передачей данных через параметры. :white_check_mark:
  > Реализованы функции read_data и print_result, в файлах read.c и print.c соответсвенно, с передачей данных через параметры, а так же функции getRandomNumber и timespecDiff в файле main.c
* Использовать локальные переменные. :white_check_mark:
  > В функциях print_result, read_data, timepecDiff и main используются локальные переменные
* В ассемблерную программу при вызове функции добавить комментарии, описывающие передачу фактических параметров и перенос возвращаемого результата. :white_check_mark:
    > При вызове всех функций присутсвуют комментарии
* В функциях для формальных параметров добавить комментарии, описывающие связь между параметрами языка Си и регистрами (стеком). :white_check_mark:
* Добавить информацию о проведенных изменениях в отчет. :white_check_mark:

### 6 балов
* Рефакторинг программы на ассемблере за счет оптимизации использования регистров процессора. Или написание ассемблерной программы с нуля, используя собственное распределение регистров. :white_check_mark:
  > Были использованы регистры r12, r13, r14, r15, r12d, r13d, r14d, r15d.
* Добавление комментариев в разработанную программу, поясняющих эквивалентное использование регистров вместо переменных исходной программы на C. :white_check_mark:
  > Добавлены, где это требуется, коментарии. Так же в начале каждого ассемблерного файла Вы можете ознакомиться с рядом комментариев, которые описывают какие переменные хранит каждый из регистров 
* Представление результатов тестовых прогонов для разработанной программы. Оценка корректности ее выполнения на основе сравнения тестовых прогонов результатами тестирования программы, разработанной на языке C. :white_check_mark:
  > В папке tests предоставлен скрипт script.py, который запускает тестирование и выводит результат. Более подробно со скриптом можно ознакомиться прочитав файл README.md, который находится в той же папке tests. В той же папке имеется файл report.txt, прочитав его, Вы можете ознакомиться с результатами тестовых прогонов. 
* Сопоставление размеров программы на ассемблере, полученной после компиляции с языка C с модифицированной программой, использующей регистры. :white_check_mark:
  > Для данного пункта были созданы файлы:<br>
    notOptimizedMain.s<br>
    notOptimizedPrint.s<br>
	  notOptimizedRead.s<br>
    notOptimizedMain.exe<br>
    С которыми Вы можете ознакомиться. <br>
    Linux команда wc показывает, что неоптимизированный notOptimizedMain.s имеет 210 строк, в то время как оптимизированный main.s 191. <br>Аналогично<br>read.s 36 <-> 42 notOptimizedRead.s<br>print.s 112 <-> notOptimizedPrint.s 104. <br>
    Опитимизированный print.s оказался с большим количеством строк, чем его неоптимизированная версия, так как там присутствует большое количество комментариев, занимающих целую строку, что так же стоит учесть и для предыдущих файлов.
* Добавить новую информацию в отчет. :white_check_mark:

### 7 балов
* Реализация программы на ассемблере в виде двух или более единиц компиляции (программу на языке C разделять допускается, но не обязательно). :white_check_mark:
  > main.c read.c print.c -> main.s read.s print.s<br>
  Программа состоит из трёх единиц компиляции.
* Использование файлов с исходными данными и файлов для вывода результатов. Имена файлов задаются с использованием аргументов командной строки. Командная строка проверяется на корректность числа аргументов и корректное открытие файлов. :white_check_mark:
  > Программа запускается командой ```./main.exe <input file> <output file>```, где первым подаётся входной файл, а вторым выходной.
* Подготовка нескольких файлов, обеспечивающих тестовое покрытие разработанной программы. :white_check_mark:
  > В папке tests находятся 200 файлов с входными и 200 файлов с выходными данными. Более подробно Вы можете ознакомиться, прочитав файл README.md, который находится в той же папке.
* Добавление в отчет информации о проведенном функциональном расширении, формате входных файлов, формате командной строки и результатах работы с тестовыми файлами. :white_check_mark:
  
### 8 балов

* Использование в разрабатываемых программах генератора случайных наборов данных, расширяющих возможности тестирования. :white_check_mark:
  > Запустив программу командой<br>```./main.exe -random <output file>```<br>будут сгенерированы рандомные данные и переданы программе. Результат можно будет выведен в output file.
* Изменение формата командной строки с учетом выбора ввода из файлов или с использованием генератора. :white_check_mark:
  > Программу можно запустить либо с файловым вводом/выводом: ```./main.exe <input file> <output file>```, либо с рандомным вводом и файловым выводом: ```./main.exe -random <output file>```. Более подробное описание в "Инструкции к применению" в начале этого файла.
* Включение в программы функций, обеспечивающих замеры времени для проведения сравнения на производительность. Необходимо добавить замеры во времени, которые не учитывают время ввода и вывода данных. Для увеличения времени работы минимум до 1 секунды, в зависимости от особенностей программы, можно либо выбирать соответствующие размеры исходных данных, либо зацикливать для многократного выполнения ту часть программы, которая выполняет вычисления. В последнем случае можно использовать соответствующую опцию командной строки, задающей количество повторений. :white_check_mark:
  > Программа замеряет время выполнения без учета ввода/вывода, независимо от формата (консольный или рандомный).
  Результат времени выполнения выводится в консоль.
* Представить полученные временные данные в отчете для разных вариантов тестовых прогонов (наряду с другими данными, полученные при выполнении ранее описанных требований). :white_check_mark:
  > Для всех тестовых данных было измерено время выполения программы. Вместе с результатами выполненного тестирования Вы можете ознакомиться с временем выполнения каждого отдельного теста в файле ```report.txt```, который находится в папке ```tests```, 
  а в папках ```inputs/outputs``` с самими входными/выходными данными.


### 9 балов

* Используя опции оптимизации по скорости, сформировать из программы на C исходный код ассемблере. Провести сравнительный анализ с ассемблерной программой без оптимизации по размеру ассемблерного кода, размеру исполняемого файла и производительности. Сопоставить эти программы с собственной программой, разработанной на ассемблере, в которой вместо переменных максимально возможно используются регистры. :white_check_mark:

	```gcc O3 {filename}.c -S -o {filename}.s```
	
  > Был создан исполняемый O3main.exe файл, с использованием оптимизаций по скорости, а так же O3main.s, O3read.s, O3print.s.<br>
  Cравним программы:<br>
  Неоптимизированная:<br>
  notOptimizedMain.s 260 строк<br>
  notOptimizedPrint.s 128 строки<br>
  notOptimizedRead 66 строки<br>
  Размер исполняемого файла: 16856 байт<br>
  Средняя скорость выполнения: 0.8 секунд<br><br>
  Оптимизированная по скорости:<br>
  O3main.s 172 строки<br>
  O3print.s 550 строк<br>
  O3read.s 39 строк<br>
  Размер исполняемого файла: 16888 байт<br>
  Средняя скорость выполнения: 0.6 секунд<br><br>
  Собственная:<br>
  main.s 191 строка<br>
  print.s 112 строк<br>
  read.s 36 строк<br>
  Размер исполняемого файла: 16672 байт<br>
  Средняя скорость выполнения: 0.5 секунд<br>


* Аналогично, используя опции оптимизации по размеру, сформировать код на ассемблере. Провести сравнительный анализ с неоптимизированной программой по размеру ассемблерного кода, размеру исполняемого файла и производительности. Сопоставить эти программы с собственной программой, разработанной на ассемблере, в которой вместо переменных максимально возможно используются регистры. :white_check_mark:
	
	```gcc -masm=intel -fno-asynchronous-unwind-tables -fno-jump-tables -fno-stack-protector -fno-exceptions -fcf-protection=none {file name}.c -S -o 	{file name}.s```
	
  > Был создан исполняемый файл sizeOptimizedMain.exe.
  sizeOptimizedMain.s, sizeOptimizedRead.s, sizeOptimizedPrint.s были оптимизированы по размеру, используя команду<br>
  Cравним программы:<br>
  Неоптимизированная:<br>
  notOptimizedMain.s 260 строк<br>
  notOptimizedPrint.s 128 строки<br>
  notOptimizedRead 66 строки<br>
  Размер исполняемого файла: 16856 байт<br>
  Средняя скорость выполнения: 0.8 секунд<br><br>
  Оптимизированная по размеру:<br>
  sizeOptimizedMain.s 210 строки<br>
  sizeOptimizedPrint.s 104 строк<br>
  sizeOptimizedRead.s 42 строк<br>
  Размер исполняемого файла: 16736 байт<br>
  Средняя скорость выполнения: 0.5 секунд<br><br>
  Собственная:<br>
  main.s 191 строка<br>
  print.s 112 строк<br>
  read.s 36 строк<br>
  Размер исполняемого файла: 16672 байт<br>
  Средняя скорость выполнения: 0.5 секунд<br>

* Представить в отчете полученные результаты, дополнив данные, представленные в предыдущем по предыдующим требованиям. :white_check_mark:
